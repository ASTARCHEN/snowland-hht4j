 这段代码是根据pudn.com的开源代码进行修改
 